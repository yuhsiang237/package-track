import{r as s,p as A,c,o as u,b as d,w as P,a,t as x,q as Y,F as y,d as _,j as ee,s as B,k as te,v as ae,x as N,y as le,z as ne,m as oe,n as J,A as se,B as ie}from"#entry";import{s as re,V as R,_ as de,a as T,b as ue,A as ce,c as ve,g as ge,H as fe,L as pe,U as me}from"./Cbyay3GV.js";import{D as ye}from"./B1WLt7ZN.js";import{toPrettyJSONString as j,daysAgo as he,downloadUserData as Ve,formatTextareaJson as ke,handlePackageJsonUpload as we}from"./DyUIkCtQ.js";import{getPackageItemData as E,setPackageItemData as be,getUserPackageData as I,setUserPackageData as L}from"./oisnR8aH.js";import{DEFAULT_USER_PACKAGE_DATA as xe}from"./CaeiBUsO.js";import{updateWidth as C}from"./BFO1sARF.js";const _e={class:"info-container"},De={class:"title-section"},Ue={class:"version-section"},$e={class:"serial"},Se={class:"version-old"},Ce={class:"serial"},Ae={class:"time"},H=22,Pe={__name:"PackageCard",props:{link:{type:String,default:""},isUpdateHighlight:{type:Boolean,default:!0},title:{type:String,default:""},currentVersion:{type:String,default:"-"},oldVersion:{type:String,default:"-"},timeAgo:{type:String,default:"-"}},setup(v){const n=v;function o(){window.open(n.link,"_blank")}const f=s(`Package Name: ${n.title}<br/>New Version: ${n.currentVersion}<br/>Current Version: ${n.oldVersion}<br/>${n.timeAgo}`),h=A(()=>re.gt(n.currentVersion||"0.0.0",n.oldVersion||"0.0.0")),p=A(()=>n.title?n.title.length>H?n.title.slice(0,H)+"…":n.title:"");return(V,g)=>(u(),c("div",{class:"package-card",onClick:o},[d(R,{title:f.value,trigger:"hover"},{default:P(()=>[a("div",_e,[a("div",De,x(p.value),1),a("div",Ue,[a("div",{class:Y(["version-current",{active:v.isUpdateHighlight&&h.value}])},[g[0]||(g[0]=a("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("ellipse",{cx:"2.72362",cy:"3.26668",rx:"2.13158",ry:"2.31111",fill:"#D07D09"})],-1)),a("div",$e,[v.currentVersion?(u(),c(y,{key:0},[_(x(v.currentVersion),1)],64)):(u(),c(y,{key:1},[_("-")],64))])],2),a("div",Se,[g[1]||(g[1]=a("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M2.72388 1.16113C3.74428 1.16128 4.60474 2.06501 4.60474 3.22266C4.60453 4.3801 3.74416 5.28305 2.72388 5.2832C1.70348 5.2832 0.842245 4.3802 0.842041 3.22266C0.842041 2.06492 1.70336 1.16113 2.72388 1.16113Z",stroke:"#E3AC40","stroke-width":"0.5"})],-1)),a("div",Ce,[v.oldVersion?(u(),c(y,{key:0},[_(x(v.oldVersion),1)],64)):(u(),c(y,{key:1},[_("-")],64))])])])]),a("div",Ae,x(v.timeAgo),1)]),_:1},8,["title"])]))}},Oe={class:"dashboard"},Be={style:{display:"flex"}},Ne={style:{display:"flex","align-items":"end"}},Je={class:"card-action"},Te={key:1,class:"card-container",style:{"min-height":"300px",display:"flex","text-align":"center","justify-content":"center","align-items":"center"}},je={class:"modal-wrapper"},Ee={class:"action-bar"},Ie={class:"content"},Le={class:"bottom-bar"},Ke=ee({__name:"index",setup(v){const n=s(xe),o=s(JSON.stringify(B(n.value),null,2)),f=s(!1),h=s([]),p=s(""),V=s("30"),g=s(!1),D=s(!0),k=s(!1),w=s(0),b=s(null),O=s(null),M=A(()=>h.value.filter(l=>{const e=!p.value||l.title.includes(p.value),t=!g.value||Number(l.timeAgo)<=Number(V.value);return e&&t}));te(()=>{W(),S(),$(Object.keys(n.value))}),ae(()=>{q()});function U(l){const e=I();if(e)try{return JSON.parse(e)[l]||null}catch(t){return console.error("解析用戶套件資料失敗:",t),null}return null}async function z(l){const e=new Date().toISOString().split("T")[0];let i=E().find(r=>{if(r.title===l)return console.log(`${r.title}=== ${l} && ${r.fetchDate} === ${e}`),r.title===l&&r.fetchDate===e});if(i)return console.log(`使用快取資料: ${l}`),i.oldVersion=U(l)||"",i;try{const r=await ge(l);return{title:r.name,currentVersion:r.latestVersion,oldVersion:U(l)||"",timeAgo:`${he(r.releaseDate)}`,fetchDate:e}}catch{return{title:l,currentVersion:"",oldVersion:U(l)||"",timeAgo:"-",fetchDate:"0001-01-01"}}}async function $(l){try{f.value=!0;const t=(await Promise.all(l.map(m=>z(m)))).filter(m=>m!==null);h.value=t;const r=[...B(t),...E()].filter((m,Z,Q)=>Q.findIndex(X=>X.title===m.title)===Z);be(r)}catch(e){console.error("批量取得套件資訊失敗:",e)}finally{f.value=!1}}function S(){const l=I();if(l)try{n.value=JSON.parse(l)}catch(e){console.error("解析用戶套件資料失敗:",e)}else{const e=j(o.value);e&&(o.value=e,L(e)),S(),$(Object.keys(n.value))}o.value=JSON.stringify(n.value,null,2)}function F(){const l=j(o.value);l&&(o.value=l,L(l)),S(),$(Object.keys(n.value)),k.value=!1}function W(){C(w,b),window.addEventListener("resize",()=>C(w,b))}function q(){window.removeEventListener("resize",()=>C(w,b))}function K(){O.value?.click()}async function G(l){const e=l.target,t=e.files?.[0];if(t){try{const i=await we(t);i?(o.value=JSON.stringify(i,null,2),console.log("✅ 成功匯入 package.json 檔案")):console.warn("⚠️ 無法解析 package.json 檔案")}catch(i){console.error("❌ 處理檔案上傳失敗:",i)}e.value=""}}return(l,e)=>(u(),c("div",Oe,[a("div",{class:"card-bar",style:le({width:w.value+"px"})},[a("div",null,[d(de,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:"關鍵字過濾"},null,8,["modelValue"])]),a("div",Be,[d(T,{label:"",modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=t=>D.value=t)},null,8,["modelValue"]),e[9]||(e[9]=a("label",null," 標記新版可升級",-1))]),a("div",Ne,[d(T,{label:"",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t)},null,8,["modelValue"]),e[10]||(e[10]=a("label",null," 僅顯示近    ",-1)),d(ue,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),options:[{label:"7",value:"7"},{label:"14",value:"14"},{label:"30",value:"30"},{label:"45",value:"45"},{label:"90",value:"90"}]},null,8,["modelValue"]),e[11]||(e[11]=a("label",null,"    天更新的套件",-1))])],4),f.value?N("",!0):(u(),c("div",{key:0,class:"card-container",ref_key:"containerRef",ref:b},[(u(!0),c(y,null,ne(M.value,(t,i)=>(u(),oe(Pe,{key:i,title:t.title,currentVersion:t.currentVersion,oldVersion:t.oldVersion,timeAgo:`${t.timeAgo} days ago`,isUpdateHighlight:D.value,link:`https://www.npmjs.com/package/${t.title}`},null,8,["title","currentVersion","oldVersion","timeAgo","isUpdateHighlight","link"]))),128)),a("div",Je,[a("div",null,[d(ce,{onClick:e[4]||(e[4]=t=>k.value=!0)})]),a("div",null,[d(R,{title:"檢視套件版本快訊，掌握套件更新。<br/>點擊 +  可新增套件至追蹤面板。",trigger:"hover"},{default:P(()=>[d(fe)]),_:1})])])],512)),f.value?(u(),c("div",Te,[a("div",null,[d(pe)])])):N("",!0),d(ve,{isOpen:k.value,class:"addDashboardModal"},{default:P(()=>[a("div",je,[a("div",Ee,[d(ye,{onClick:e[5]||(e[5]=t=>J(Ve)(o.value))}),d(me,{onClick:K}),a("input",{ref_key:"fileInputRef",ref:O,type:"file",accept:".json",style:{display:"none"},onChange:G},null,544)]),a("div",Ie,[se(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value=t),onBlur:e[7]||(e[7]=t=>o.value=J(ke)(o.value))},null,544),[[ie,o.value]])]),a("div",Le,[a("div",{class:"cancel",onClick:e[8]||(e[8]=t=>k.value=!1)},"取消"),a("div",{class:"save",onClick:F},"儲存")])])]),_:1},8,["isOpen"])]))}});export{Ke as _};
