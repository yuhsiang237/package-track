import{s as K,A as G,V as Z,c as Q,g as W,_ as X,a as Y,b as ee,H as te,L as ae,U as le}from"./Cbyay3GV.js";import{r as c,p as C,c as v,o as u,a as t,t as _,q as ne,F as k,d as m,j as oe,s as P,k as se,x as A,b as d,z as re,w as O,m as ie,n as B,A as ce,B as de}from"#entry";import{_ as ue}from"./DlAUqK2U.js";import{D as ve}from"./B1WLt7ZN.js";import{daysAgo as ge,downloadUserData as fe,formatTextareaJson as pe,toPrettyJSONString as N,handlePackageJsonUpload as me}from"./Cez18MZk.js";import{getPackageItemData as J,setPackageItemData as ye,getUserPackageData as T,setUserPackageData as I}from"./DQNbzUuG.js";import{DEFAULT_USER_PACKAGE_DATA as ke}from"./BbepNIDu.js";const he={class:"left-area"},Ve={class:"title-section"},_e={class:"right-area"},we={class:"version-section"},xe={class:"serial"},be={class:"version-old"},De={class:"serial"},$e={class:"time"},j=22,Ce={__name:"MPackageCard",props:{link:{type:String,default:""},isUpdateHighlight:{type:Boolean,default:!0},title:{type:String,default:""},currentVersion:{type:String,default:"-"},oldVersion:{type:String,default:"-"},timeAgo:{type:String,default:"-"}},setup(g){const n=g;function s(){window.open(n.link,"_blank")}c(`Package Name: ${n.title}<br/>New Version: ${n.currentVersion}<br/>Current Version: ${n.oldVersion}<br/>${n.timeAgo}`);const p=C(()=>K.gt(n.currentVersion||"0.0.0",n.oldVersion||"0.0.0")),h=C(()=>n.title?n.title.length>j?n.title.slice(0,j)+"…":n.title:"");return(y,f)=>(u(),v("div",{class:"m-package-card",onClick:s},[t("div",he,[t("div",Ve,_(h.value),1)]),t("div",_e,[t("div",we,[t("div",{class:ne(["version-current",{active:g.isUpdateHighlight&&p.value}])},[f[0]||(f[0]=t("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("ellipse",{cx:"2.72362",cy:"3.26668",rx:"2.13158",ry:"2.31111",fill:"#D07D09"})],-1)),t("div",xe,[g.currentVersion?(u(),v(k,{key:0},[m(_(g.currentVersion),1)],64)):(u(),v(k,{key:1},[m("-")],64))])],2),t("div",be,[f[1]||(f[1]=t("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M2.72388 1.16113C3.74428 1.16128 4.60474 2.06501 4.60474 3.22266C4.60453 4.3801 3.74416 5.28305 2.72388 5.2832C1.70348 5.2832 0.842245 4.3802 0.842041 3.22266C0.842041 2.06492 1.70336 1.16113 2.72388 1.16113Z",stroke:"#E3AC40","stroke-width":"0.5"})],-1)),t("div",De,[g.oldVersion?(u(),v(k,{key:0},[m(_(g.oldVersion),1)],64)):(u(),v(k,{key:1},[m("-")],64))])])]),t("div",$e,_(g.timeAgo),1)])]))}},Se=ue(Ce,[["__scopeId","data-v-88072132"]]),Ue={class:"m-dashboard"},Pe={class:"filter-key"},Ae={class:"filter-area"},Oe={style:{display:"flex","margin-bottom":"8px"}},Be={style:{display:"flex","align-items":"flex-end",gap:"5px"}},Ne={class:"card-action"},Je={key:1,class:"card-container",style:{"min-height":"300px",display:"flex","text-align":"center","justify-content":"center","align-items":"center"}},Te={class:"modal-wrapper"},Ie={class:"action-bar"},je={class:"content"},Me={class:"bottom-bar"},Ke=oe({__name:"index",setup(g){const n=c(ke),s=c(JSON.stringify(P(n.value),null,2)),p=c(!1),h=c([]),y=c(""),f=c("30"),w=c(!1),x=c(!0),V=c(!1);c(0);const M=c(null),S=c(null),H=C(()=>h.value.filter(a=>{const e=!y.value||a.title.includes(y.value),r=!w.value||Number(a.timeAgo)<=Number(f.value);return e&&r}));se(()=>{D(Object.keys(n.value))});function b(a){const e=T();if(e)try{return JSON.parse(e)[a]||null}catch(r){return console.error("解析用戶套件資料失敗:",r),null}return null}async function E(a){const e=new Date().toISOString().split("T")[0];let i=J().find(o=>{if(o.title===a)return console.log(`${o.title}=== ${a} && ${o.fetchDate} === ${e}`),o.title===a&&o.fetchDate===e});if(i)return console.log(`使用快取資料: ${a}`),i.oldVersion=b(a)||"",i;try{const o=await W(a);return{title:o.name,currentVersion:o.latestVersion,oldVersion:b(a)||"",timeAgo:`${ge(o.releaseDate)}`,fetchDate:e}}catch{return{title:a,currentVersion:"",oldVersion:b(a)||"",timeAgo:"-",fetchDate:"0001-01-01"}}}async function D(a){try{p.value=!0;const r=(await Promise.all(a.map(l=>E(l)))).filter(l=>l!==null);h.value=r;const o=[...P(r),...J()].filter((l,$,q)=>q.findIndex(z=>z.title===l.title)===$);ye(o)}catch(e){console.error("批量取得套件資訊失敗:",e)}finally{p.value=!1}}function U(){const a=T();if(a)try{n.value=JSON.parse(a)}catch(e){console.error("解析用戶套件資料失敗:",e)}else{const e=N(s.value);e&&(s.value=e,I(e)),U(),D(Object.keys(n.value))}s.value=JSON.stringify(n.value,null,2)}function L(){const a=N(s.value);a&&(s.value=a,I(a)),U(),D(Object.keys(n.value)),V.value=!1}function R(){S.value?.click()}async function F(a){const e=a.target,r=e.files?.[0];if(r){try{const i=await me(r);i?(s.value=JSON.stringify(i,null,2),console.log("✅ 成功匯入 package.json 檔案")):console.warn("⚠️ 無法解析 package.json 檔案")}catch(i){console.error("❌ 處理檔案上傳失敗:",i)}e.value=""}}return(a,e)=>{const r=X,i=Y,o=ee;return u(),v("div",Ue,[e[12]||(e[12]=t("div",{class:"intro"},[m(" 自動化監控前端套件更新，穩定追蹤。"),t("br"),m(" 專注開發，隨時掌握版本動態。 ")],-1)),t("div",Pe,[d(r,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),placeholder:"關鍵字過濾"},null,8,["modelValue"])]),t("div",Ae,[t("div",Oe,[d(i,{label:"",modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=l=>x.value=l)},null,8,["modelValue"]),e[9]||(e[9]=t("label",null," 標記新版可升級",-1))]),t("div",Be,[d(i,{label:"",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l)},null,8,["modelValue"]),e[10]||(e[10]=t("label",null,"僅顯示近",-1)),d(o,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),options:[{label:"7",value:"7"},{label:"14",value:"14"},{label:"30",value:"30"},{label:"45",value:"45"},{label:"90",value:"90"}]},null,8,["modelValue"]),e[11]||(e[11]=t("label",null,"天套件",-1))])]),p.value?A("",!0):(u(),v("div",{key:0,class:"card-container",ref_key:"containerRef",ref:M},[(u(!0),v(k,null,re(H.value,(l,$)=>(u(),ie(Se,{key:$,title:l.title,currentVersion:l.currentVersion,oldVersion:l.oldVersion,timeAgo:`${l.timeAgo} days ago`,isUpdateHighlight:x.value,link:`https://www.npmjs.com/package/${l.title}`},null,8,["title","currentVersion","oldVersion","timeAgo","isUpdateHighlight","link"]))),128)),t("div",Ne,[t("div",null,[d(G,{onClick:e[4]||(e[4]=l=>V.value=!0)})]),t("div",null,[d(Z,{title:"檢視套件版本快訊，掌握套件更新。<br/>點擊 +  可新增套件至追蹤面板。",trigger:"hover"},{default:O(()=>[d(te)]),_:1})])])],512)),p.value?(u(),v("div",Je,[t("div",null,[d(ae)])])):A("",!0),d(Q,{isOpen:V.value,class:"addDashboardModal"},{default:O(()=>[t("div",Te,[t("div",Ie,[d(ve,{onClick:e[5]||(e[5]=l=>B(fe)(s.value))}),d(le,{onClick:R}),t("input",{ref_key:"fileInputRef",ref:S,type:"file",accept:".json",style:{display:"none"},onChange:F},null,544)]),t("div",je,[ce(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value=l),onBlur:e[7]||(e[7]=l=>s.value=B(pe)(s.value))},null,544),[[de,s.value]])]),t("div",Me,[t("div",{class:"cancel",onClick:e[8]||(e[8]=l=>V.value=!1)},"取消"),t("div",{class:"save",onClick:L},"儲存")])])]),_:1},8,["isOpen"])])}}});export{Ke as _};
