import{s as z,A as K,V as Q,c as Z,g as W,_ as X,a as Y,b as ee,H as te,L as le,U as ne}from"./CpiH5u6D.js";import{_ as ae,r as c,p as $,c as p,o as v,a as t,t as w,q as oe,F as h,d as k,Q as se,j as re,s as P,k as ie,x as A,b as d,z as ce,w as O,m as de,n as B,A as ue,B as ve}from"#entry";import{D as pe}from"./yMyOA5NV.js";import{daysAgo as ge,downloadUserData as fe,formatTextareaJson as me,toPrettyJSONString as N,handlePackageJsonUpload as ke}from"./Cez18MZk.js";import{getPackageItemData as J,setPackageItemData as ye,getUserPackageData as M,setUserPackageData as T}from"./DQNbzUuG.js";import{DEFAULT_USER_PACKAGE_DATA as he}from"./BbepNIDu.js";const Ve={class:"left-area"},_e={class:"title-section"},we={class:"right-area"},be={class:"version-section"},xe={class:"serial"},De={class:"version-old"},Ce={class:"serial"},$e={class:"time"},I=22,Se={__name:"MPackageCard",props:{repolink:{type:String,default:""},npmlink:{type:String,default:""},isUpdateHighlight:{type:Boolean,default:!0},title:{type:String,default:""},currentVersion:{type:String,default:"-"},oldVersion:{type:String,default:"-"},timeAgo:{type:String,default:"-"}},setup(g){const a=g;c(`Package Name: ${a.title}<br/>New Version: ${a.currentVersion}<br/>Current Version: ${a.oldVersion}<br/>${a.timeAgo}`);const s=$(()=>z.gt(a.currentVersion||"0.0.0",a.oldVersion||"0.0.0")),m=$(()=>a.title?a.title.length>I?a.title.slice(0,I)+"…":a.title:""),V=f=>{se.showContextMenu({x:f.x,y:f.y,items:[{label:"Go NPM",onClick:()=>window.open(a.npmlink,"_blank")},{label:"Go Repo",onClick:()=>window.open(a.repolink,"_blank")},{label:"Go Release",onClick:()=>window.open(`${a.repolink}/releases`,"_blank")}]})};return(f,u)=>(v(),p("div",{class:"m-package-card",onClick:u[0]||(u[0]=y=>V(y))},[t("div",Ve,[t("div",_e,w(m.value),1)]),t("div",we,[t("div",be,[t("div",{class:oe(["version-current",{active:g.isUpdateHighlight&&s.value}])},[u[1]||(u[1]=t("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("ellipse",{cx:"2.72362",cy:"3.26668",rx:"2.13158",ry:"2.31111",fill:"#D07D09"})],-1)),t("div",xe,[g.currentVersion?(v(),p(h,{key:0},[k(w(g.currentVersion),1)],64)):(v(),p(h,{key:1},[k("-")],64))])],2),t("div",De,[u[2]||(u[2]=t("svg",{width:"5",height:"6",viewBox:"0 0 5 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M2.72388 1.16113C3.74428 1.16128 4.60474 2.06501 4.60474 3.22266C4.60453 4.3801 3.74416 5.28305 2.72388 5.2832C1.70348 5.2832 0.842245 4.3802 0.842041 3.22266C0.842041 2.06492 1.70336 1.16113 2.72388 1.16113Z",stroke:"#E3AC40","stroke-width":"0.5"})],-1)),t("div",Ce,[g.oldVersion?(v(),p(h,{key:0},[k(w(g.oldVersion),1)],64)):(v(),p(h,{key:1},[k("-")],64))])])]),t("div",$e,w(g.timeAgo),1)])]))}},Ue=ae(Se,[["__scopeId","data-v-7186b17b"]]),Pe={class:"m-dashboard"},Ae={class:"filter-key"},Oe={class:"filter-area"},Be={style:{display:"flex","margin-bottom":"8px"}},Ne={style:{display:"flex","align-items":"flex-end",gap:"5px"}},Je={class:"card-action"},Me={key:1,class:"card-container",style:{"min-height":"300px",display:"flex","text-align":"center","justify-content":"center","align-items":"center"}},Te={class:"modal-wrapper"},Ie={class:"action-bar"},je={class:"content"},Re={class:"bottom-bar"},ze=re({__name:"index",setup(g){const a=c(he),s=c(JSON.stringify(P(a.value),null,2)),m=c(!1),V=c([]),f=c(""),u=c("30"),y=c(!1),b=c(!0),_=c(!1);c(0);const j=c(null),S=c(null),R=$(()=>V.value.filter(l=>{const e=!f.value||l.title.includes(f.value),r=!y.value||Number(l.timeAgo)<=Number(u.value);return e&&r}));ie(()=>{D(Object.keys(a.value))});function x(l){const e=M();if(e)try{return JSON.parse(e)[l]||null}catch(r){return console.error("解析用戶套件資料失敗:",r),null}return null}async function H(l){const e=new Date().toISOString().split("T")[0];let i=J().find(o=>{if(o.title===l)return console.log(`${o.title}=== ${l} && ${o.fetchDate} === ${e}`),o.title===l&&o.fetchDate===e});if(i)return console.log(`使用快取資料: ${l}`),i.oldVersion=x(l)||"",i;try{const o=await W(l);return{title:o.name,currentVersion:o.latestVersion,oldVersion:x(l)||"",timeAgo:`${ge(o.releaseDate)}`,fetchDate:e,repo:o.repo}}catch{return{title:l,currentVersion:"",oldVersion:x(l)||"",timeAgo:"-",fetchDate:"0001-01-01",repo:""}}}async function D(l){try{m.value=!0;const r=(await Promise.all(l.map(n=>H(n)))).filter(n=>n!==null);V.value=r;const o=[...P(r),...J()].filter((n,C,G)=>G.findIndex(q=>q.title===n.title)===C);ye(o)}catch(e){console.error("批量取得套件資訊失敗:",e)}finally{m.value=!1}}function U(){const l=M();if(l)try{a.value=JSON.parse(l)}catch(e){console.error("解析用戶套件資料失敗:",e)}else{const e=N(s.value);e&&(s.value=e,T(e)),U(),D(Object.keys(a.value))}s.value=JSON.stringify(a.value,null,2)}function E(){const l=N(s.value);l&&(s.value=l,T(l)),U(),D(Object.keys(a.value)),_.value=!1}function L(){S.value?.click()}async function F(l){const e=l.target,r=e.files?.[0];if(r){try{const i=await ke(r);i?(s.value=JSON.stringify(i,null,2),console.log("✅ 成功匯入 package.json 檔案")):console.warn("⚠️ 無法解析 package.json 檔案")}catch(i){console.error("❌ 處理檔案上傳失敗:",i)}e.value=""}}return(l,e)=>{const r=X,i=Y,o=ee;return v(),p("div",Pe,[e[12]||(e[12]=t("div",{class:"intro"},[k(" 自動化監控前端套件更新，穩定追蹤。"),t("br"),k(" 專注開發，隨時掌握版本動態。 ")],-1)),t("div",Ae,[d(r,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),placeholder:"關鍵字過濾"},null,8,["modelValue"])]),t("div",Oe,[t("div",Be,[d(i,{label:"",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=n=>b.value=n)},null,8,["modelValue"]),e[9]||(e[9]=t("label",null," 標記新版可升級",-1))]),t("div",Ne,[d(i,{label:"",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n)},null,8,["modelValue"]),e[10]||(e[10]=t("label",null,"僅顯示近",-1)),d(o,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value=n),options:[{label:"7",value:"7"},{label:"14",value:"14"},{label:"30",value:"30"},{label:"45",value:"45"},{label:"90",value:"90"}]},null,8,["modelValue"]),e[11]||(e[11]=t("label",null,"天套件",-1))])]),m.value?A("",!0):(v(),p("div",{key:0,class:"card-container",ref_key:"containerRef",ref:j},[(v(!0),p(h,null,ce(R.value,(n,C)=>(v(),de(Ue,{key:C,title:n.title,currentVersion:n.currentVersion,oldVersion:n.oldVersion,timeAgo:`${n.timeAgo} days ago`,isUpdateHighlight:b.value,npmlink:`https://www.npmjs.com/package/${n.title}`,repolink:n.repo},null,8,["title","currentVersion","oldVersion","timeAgo","isUpdateHighlight","npmlink","repolink"]))),128)),t("div",Je,[t("div",null,[d(K,{onClick:e[4]||(e[4]=n=>_.value=!0)})]),t("div",null,[d(Q,{title:"檢視套件版本快訊，掌握套件更新。<br/>點擊 +  可新增套件至追蹤面板。",trigger:"hover"},{default:O(()=>[d(te)]),_:1})])])],512)),m.value?(v(),p("div",Me,[t("div",null,[d(le)])])):A("",!0),d(Z,{isOpen:_.value,class:"addDashboardModal"},{default:O(()=>[t("div",Te,[t("div",Ie,[d(pe,{onClick:e[5]||(e[5]=n=>B(fe)(s.value))}),d(ne,{onClick:L}),t("input",{ref_key:"fileInputRef",ref:S,type:"file",accept:".json",style:{display:"none"},onChange:F},null,544)]),t("div",je,[ue(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.value=n),onBlur:e[7]||(e[7]=n=>s.value=B(me)(s.value))},null,544),[[ve,s.value]])]),t("div",Re,[t("div",{class:"cancel",onClick:e[8]||(e[8]=n=>_.value=!1)},"取消"),t("div",{class:"save",onClick:E},"儲存")])])]),_:1},8,["isOpen"])])}}});export{ze as _};
